# This is a basic workflow to help you get started with Actions
import React, { useState } from 'react';

const UtiIntakeForm = () => {
  const [step, setStep] = useState(0);
  const [formData, setFormData] = useState({});
  const [status, setStatus] = useState('active'); // 'active', 'referral', 'complete'
  const [referralReason, setReferralReason] = useState('');

  // Define the questions and logic
  const questions = [
    {
      id: 'gender',
      text: 'What is your biological sex?',
      options: ['Female', 'Male'],
      logic: (answer) => {
        if (answer === 'Male') return { stop: true, reason: 'Ontario pharmacists can currently only prescribe for UTIs in females. Please see a physician.' };
        return { stop: false };
      }
    },
    {
      id: 'age',
      text: 'Are you 12 years of age or older?',
      options: ['Yes', 'No'],
      logic: (answer) => {
        if (answer === 'No') return { stop: true, reason: 'Patients under 12 require a physician assessment for UTIs.' };
        return { stop: false };
      }
    },
    {
      id: 'red_flags',
      text: 'Do you have fever, chills, or back/flank pain?',
      options: ['Yes', 'No'],
      logic: (answer) => {
        if (answer === 'Yes') return { stop: true, reason: 'These symptoms suggest a more serious kidney infection (Pyelonephritis). Please go to ER or Urgent Care.' };
        return { stop: false };
      }
    },
    {
      id: 'pregnancy',
      text: 'Is there a chance you are pregnant?',
      options: ['Yes', 'No'],
      logic: (answer) => {
        if (answer === 'Yes') return { stop: true, reason: 'UTIs during pregnancy require physician monitoring.' };
        return { stop: false };
      }
    }
  ];

  const handleAnswer = (answer) => {
    const currentQuestion = questions[step];
    
    // Save the answer
    setFormData({ ...formData, [currentQuestion.id]: answer });

    // Check Logic
    const result = currentQuestion.logic(answer);

    if (result.stop) {
      setStatus('referral');
      setReferralReason(result.reason);
    } else {
      if (step < questions.length - 1) {
        setStep(step + 1);
      } else {
        setStatus('complete');
      }
    }
  };

  return (
    <div className="p-6 max-w-md mx-auto bg-white rounded-xl shadow-md space-y-4">
      <h2 className="text-xl font-bold text-gray-900">Ontario Minor Ailment Check: UTI</h2>
      
      {status === 'active' && (
        <div>
          <p className="text-lg mb-4">{questions[step].text}</p>
          <div className="flex gap-4">
            {questions[step].options.map((option) => (
              <button
                key={option}
                onClick={() => handleAnswer(option)}
                className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
              >
                {option}
              </button>
            ))}
          </div>
          <p className="text-sm text-gray-500 mt-4">Question {step + 1} of {questions.length}</p>
        </div>
      )}

      {status === 'referral' && (
        <div className="p-4 bg-red-50 border-l-4 border-red-500 text-red-700">
          <h3 className="font-bold">Referral Needed</h3>
          <p>{referralReason}</p>
          <button onClick={() => window.location.reload()} className="mt-4 text-sm underline">Start Over</button>
        </div>
      )}

      {status === 'complete' && (
        <div className="p-4 bg-green-50 border-l-4 border-green-500 text-green-700">
          <h3 className="font-bold">Assessment Complete</h3>
          <p>You meet the criteria for a Pharmacist Assessment.</p>
          <p className="mt-2 text-sm">Summary generated for Pharmacist...</p>
        </div>
      )}
    </div>
  );
};

export default UtiIntakeForm;

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v4

      # Runs a single command using the runners shell
      - name: Run a one-line script
        run: echo Hello, world!

      # Runs a set of commands using the runners shell
      - name: Run a multi-line script
        run: |
          echo Add other actions to build,
          echo test, and deploy your project.
